<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <title>Furigana + DeepL</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    :root { --bg:#0b0f14; --card:#11161f; --ink:#e6edf3; --line:#223044; --muted:#9fb0c2; --accent:#5aa9ff; }
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--ink);font-family:system-ui,-apple-system,Segoe UI,Roboto,Noto Sans,Apple SD Gothic Neo,sans-serif}
    header{padding:16px 20px;border-bottom:1px solid var(--line)}
    h1{margin:0;font-size:16px;font-weight:600}
    main{max-width:900px;margin:0 auto;padding:20px}
    .card{background:var(--card);border:1px solid var(--line);border-radius:14px;padding:14px;margin-bottom:14px}
    .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
    .btn{background:#182233;color:var(--ink);border:1px solid var(--line);padding:10px 14px;border-radius:10px;cursor:pointer}
    .btn:hover{background:#1e2a3f}
    .btn.primary{background:var(--accent);color:#06111e;border-color:#2d80e4;font-weight:600}
    .label{font-size:13px;color:var(--muted);margin-bottom:8px}
    .out{min-height:100px;background:#0e141c;border:1px solid var(--line);border-radius:10px;padding:12px;overflow:auto}
    .right{margin-left:auto}
    .kbd{font:12px/1 ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;color:#cbd6e2;background:#121820;border:1px solid var(--line);border-radius:6px;padding:2px 6px}
    .error{color:#ffb3b3}

    /* 클릭 가능한 토큰 (표시: 카나만) */
    .tok{padding:1px 2px;border-radius:6px;cursor:pointer}
    .tok:hover{background:#1a2436}
    .tok[data-clickable="0"]{cursor:default}

    /* 팝업 */
    .pop{position:fixed;z-index:9999;max-width:320px;background:#0f1520;border:1px solid #2a3950;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.4);padding:10px}
    .pop h4{margin:0 0 6px 0;font-size:14px}
    .kv{font-size:12px;color:#c1cfde;margin:4px 0}
    .kv b{color:#8fb4ff}
    .pop .act{display:flex;gap:8px;margin-top:8px}
    .pop .act .btn{padding:6px 10px;border-radius:8px}
    .hidden{display:none}

    /* 입력 모달 */
    .modalWrap{position:fixed;inset:0;background:rgba(0,0,0,.5);display:flex;align-items:center;justify-content:center;z-index:9998}
    .modal{width:min(90vw,600px);background:#0f1520;border:1px solid #2a3950;border-radius:12px;box-shadow:0 10px 30px rgba(0,0,0,.4);padding:14px}
    textarea{width:100%;min-height:120px;background:#0e141c;color:var(--ink);border:1px solid var(--line);border-radius:10px;padding:12px;resize:vertical;line-height:1.5;font-family:inherit}

    ruby rt{font-size:.75em;color:#b9c8d8}
  </style>
</head>
<body>
<header><h1>Furigana + DeepL</h1></header>
<main>
  <!-- 상단 컨트롤 -->
  <section class="card">
    <div class="row">
      <button class="btn" id="openInput">입력 텍스트</button>
      <button class="btn" id="btnFuri">후리가나</button>
      <button class="btn" id="btnTrans">번역</button>
      <button class="btn primary" id="btnBoth">둘 다</button>
      <span class="right" style="color:#9fb0c2;font-size:12px">단축키: <span class="kbd">Ctrl/⌘+Enter</span></span>
    </div>
  </section>

  <!-- 결과 1: 읽기(카나 전용 / 클릭 팝업) -->
  <section class="card">
    <div class="label">읽기(카나 전용) — 토큰을 클릭하면 팝업</div>
    <div id="kanaOut" class="out" aria-live="polite"></div>
  </section>

  <!-- 결과 2: 원문(루비: 한자+rt 포함) -->
  <section class="card">
    <div class="label">원문(루비)</div>
    <div id="rubyOut" class="out" aria-live="polite"></div>
  </section>

  <!-- 결과 3: DeepL 번역 -->
  <section class="card">
    <div class="row" style="margin-bottom:8px">
      <div class="label" style="margin:0">DeepL 번역(문장 전체)</div>
      <button class="btn right" id="copyTrans">텍스트 복사</button>
    </div>
    <div id="transOut" class="out" aria-live="polite"></div>
  </section>
</main>

<!-- (숨김) 실제 입력 저장용 -->
<textarea id="input" class="hidden" style="display:none"></textarea>

<!-- 입력 모달 -->
<div id="inputModal" class="modalWrap hidden" role="dialog" aria-modal="true">
  <div class="modal">
    <div class="label">입력 텍스트</div>
    <textarea id="inputVal" placeholder="여기에 붙여넣기"></textarea>
    <div class="row" style="margin-top:10px">
      <button class="btn" id="pasteBtn">클립보드에서 붙여넣기</button>
      <button class="btn primary" id="okInput">확인</button>
      <button class="btn" id="cancelInput">취소</button>
    </div>
  </div>
</div>

<!-- 토큰 팝업 -->
<div id="pop" class="pop hidden" role="dialog" aria-live="polite">
  <h4 id="popSurface"></h4>
  <div class="kv" id="kvLemma"><b>Lemma</b>: <span id="popLemma"></span></div>
  <div class="kv" id="kvRuby"><b>Ruby</b>: <span id="popRuby"></span></div>
  <div class="kv"><b>DeepL</b>: <span id="popDeepl"></span></div>
  <div class="act">
    <button class="btn" id="popCopy">복사</button>
    <button class="btn" id="popClose">닫기</button>
  </div>
</div>

<script>
/* ===== 고정 엔드포인트 ===== */
const FURIGANA_URL = "https://furigana-api-345684237835.asia-northeast3.run.app/furigana";
const DEEPL_URL    = "https://solitary-mud-8caf.rlaalsrbr.w_
